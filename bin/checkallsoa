#!/bin/sh

AUTOREGBIN=/usr/local/autoreg/bin

for z in `${AUTOREGBIN}/access-zone -alist`; do
  input=`(echo $z;
    ${AUTOREGBIN}/access-zone -ashow -z$z $z |
    awk '			\
	/^;/ { next }		\
	/^\t+NS\t+/ { print substr ($2,1,length($2)-1); }	\
	/^\t+\d+\t+NS\t+/ { print substr ($3,1,length($3)-1); }'
  )`
  # split in 2 lines to get correct exit status from check-ns
  out=`echo "$input" | ${AUTOREGBIN}/check-ns -g`
  if [ "$?" != 0 ]; then
    echo '****' $z FAILED '****'
    echo "$out"
  fi
done
