#!/usr/bin/perl
#
# $Id$
#
# Gets a name in argument and checks there's a correct record for it,
# not a CNAME.
#

# calls to "dig" more or less stolen from dnswalk, originally written
# by Dave Barr.

require "/usr/local/dns-manager/conf/config";
require "$DNSLIB/dns.pl";
require "$DNSLIB/misc.pl";
require "$DNSCONF/msg-check";

if ($#ARGV == 0) {
	$domain	= &fqdncanon($ARGV[0]);
} else {
	die "Usage: check-cname {domain}\n";
}

local ($err, $res) = &checkcname($domain);
if ($err) {
	die sprintf($ERR_NOTF, $domain, $err);
} else {
	if ($res) {
		die sprintf($ERR_ISCAN, $domain, $res);
	}
}
exit;

# checkcname(domain)
sub checkcname {
    return &dns_get_type($_[0], "CNAME");
}
