#!/usr/bin/perl
#
# $Id$
#
# Gets a name in argument and checks there's a correct A record for it.
#

# calls to "dig" more or less stolen from dnswalk, originally written
# by Dave Barr.

require "/usr/local/dns-manager/conf/config";
require "$DNSLIB/dns.pl";
require "$DNSCONF/msg-check";

if ($#ARGV == 0) {
	$domain	= &fqdncanon($ARGV[0]);
} else {
	die "Usage: check-mx {domain}\n";
}

$res = &checkcname($domain);
if ($res) {
	die sprintf($ERR_ISCAN, $domain, $res);
}

$res = &checka($domain);
if (!$res) {
	die sprintf($ERR_DOMNA, $domain);
}
exit;

# Check that a CNAME does not point to another CNAME.
#
# checkcname(domain)
sub checkcname {
    return &dns_get_type($_[0], "CNAME");
}

#
# checka(domain)
sub checka {
    return &dns_get_type($_[0], "A");
}
