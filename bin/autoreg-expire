#!/usr/local/bin/python

from __future__ import print_function

import sys

import psycopg2

from autoreg.common import domain_delete
import autoreg.conf 
import autoreg.dns.db         
import autoreg.whois.db         

dbh = psycopg2.connect(autoreg.conf.dbstring)
dd = autoreg.dns.db.db(dbh)
dd.login('autoreg')

whoisdb = autoreg.whois.db.Main(dbh)

for dom, zone, dateexp in dd.expired(now=True):
  print('%s %s.%s' % (dateexp, dom, zone))
  fqdn = dom + '.' + zone
  domain_delete(dd, fqdn, whoisdb, out=sys.stdout, grace_days=0)
